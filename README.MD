
<h3 align="center">
  Desafio  Softplan
</h3>

<blockquote align="center">â€œNÃ£o espere resultados brilhantes se suas metas nÃ£o forem clarasâ€!</blockquote>

<p align="center">
  <img alt="License" src="https://img.shields.io/badge/license-MIT-%2304D361">
</p>

<p align="center">
  <a href="#rocket-sobre-o-desafio">Sobre o desafio</a>&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;
  <a href="#memo-licenÃ§a">LicenÃ§a</a>
</p>

## :rocket: Sobre o desafio

-   Desenvolver uma aplicaÃ§Ã£o web responsÃ¡vel por gerenciar processos.
-   _SoluÃ§Ãµes parcias serÃ£o aceitas._
-   VisÃ£o de administrador
    -   Incluir, excluir, atualizar e visualizar usuÃ¡rios,
-   VisÃ£o de usuÃ¡rio-triador
    -   Incluir e visualizar processos,
    -   Atribuir um ou mais usuÃ¡rios a realizar um parecer sobre um processo,
-   VisÃ£o de usuÃ¡rio-finalizador
    -   Visualizar processos pendentes de parecer.
    -   Incluir o parecer sobre o processo.

# :hammer:  Backend

- Java 1.8
- SpringBoot
- Spring Data
- Spring Security
- Spring Security - OAuth
- Spring Security - JWT
- Banco de dados H2 (in-memory)
- FlywayDB

## :hammer: Tecnologias (Frontend)
- Angular 11
- PrimeNG (Biblioteca de componentes angular)
- auth0/angular-jwt (Biblioteca para uso do JSON Web Token)
 


### :game_die: Layout da aplicaÃ§Ã£o


## :key: Como rodar esse projeto.

Para executar este sistema, vocÃª precisarÃ¡ de  Java 1.8, Angular11 e Node.js  instalados em seu computador;

### :sheep: Clonando o repositÃ³rio.
```
# Clone este repositÃ³rio
$ git clone git@github.com:LuizSerra/softplan-desafio-fullstack-Luiz-Serra.git
```
### :computer: Rodando a aplicaÃ§Ã£o - Backend


OpÃ§Ã£o 1
 No terminal:
$ Execute o comando "mvn package" na raiz do projeto.
$ VÃ¡ atÃ© a pasta target e execute o comando Java -jar 

OpÃ§Ã£o 2
$ Importe o projeto Softplan na IDE
$ Rode a AplicaÃ§Ã£o

 O servidor serÃ¡ executado em http://localhost:8080
 O banco de dados utilizado Ã© o **H2**, com persistÃªncia em memÃ³ria. Para acessar o gerenciador, via browser, acesse a url http://localhost:8080/console
EstÃ£o configuradas no arquivo aplication.properties as credencias utilizadas no banco que serÃ£o solicitadas pelo gerenciador:
	
	spring.datasource.url=jdbc:h2:mem:testdb
	spring.datasource.driverClassName=org.h2.Driver
	spring.datasource.username=sa
	spring.datasource.password=
	spring.datasource.platform=h2

Devido a uma falha na compatibilidade entre o banco H2 e o flywayDB, 
as migrations estÃ£o sendo executadas apenas em seus comandos DDL e nÃ£o os DML, portanto, faz-se necessÃ¡rio que uma vez que a aplicaÃ§Ã£o esteja rodando, que se execute o conteÃºdo do arquivo [softplan script.sql](https://github.com/LuizSerra/softplan-desafio-fullstack-Luiz-Serra/blob/master/softplan%20script.sql "softplan script.sql")  seja executado na base de dados para que as tabelas sejam populadas com os dados iniciais, sobretudo a criaÃ§Ã£o dos usuÃ¡rios e papÃ©is.
 O mapeamento objeto-relacional foi feito utilizando Spring Data JPA e a implementaÃ§Ã£o Ã© Hibernate.

### Funcionalidades da aplicaÃ§Ã£o

O Backend fornece uma API REST com os seguintes recursos:
 
- **`Usuario`**: Os endpoints estÃ£o mapeados na classe UsuarioController

- **`Processo`**: Os endpoints estÃ£o mapeados na classe Processo Controller

- **`Parecer`**: Os endpoints estÃ£o mapeados na classe ParecerController

- **`Permissao`**: Os endpoints estÃ£o mapeados na classe PermissaoController

Para maiores detalhes e utilizaÃ§Ã£o via Postman hÃ¡, na raiz do projeto neste Git, a seguinte collection: [SoftPlanCollection](https://github.com/LuizSerra/softplan-desafio-fullstack-Luiz-Serra/blob/master/SOFTPLAN%20Security.postman_collection.json) 

#### SeguranÃ§a

A SeguranÃ§a da API REST Ã© feita utilizando Spring Security.
OAUTH e JWT -> Para se autenticar na AplicaÃ§Ã£o Ã© preciso realizar um request na rota localhost:8080/oauth/token
que retornarÃ¡ um token e um refresh_token. Esse ultimo estÃ¡ sendo adicionado a um cookie e Ã© utilizado para renovaÃ§Ã£o do token. 
Consulte a Colletion jÃ¡ mencionada, no requests para token e refresh_token, para obter mais detalhes sobre cabeÃ§alho, parÃ¢metros e body necessÃ¡rios nessas requests.
Para acessara cada uma das demais rotas da aplicaÃ§Ã£o Ã© necessÃ¡rio informar um access_token vÃ¡lido, que pode ser obtido como resposta da requisiÃ§Ã£o para refresh_token; Esse token deve ser enviado em cada requisiÃ§Ã£o em um Header Authorization.

### :computer: Rodando a aplicaÃ§Ã£o - Frontend

No terminal
$ Entre na pasta sftpln-ui e excute o comando npm install, para baixar as dependÃªncias do projeto;
$Execute o comando ng serve. Isso farÃ¡ com que a aplicÃ§Ã£o suba no servidor no seguinte endereÃ§o http://localhost:4200

### Funcionalidades da aplicaÃ§Ã£o
A tela de login pode ser acessada atravÃ©s da seguinte rota http://localhost:4200/login
Em geral a usabilidade Ã© muito simples. Existem duas entidades principais, usuÃ¡rios e processos com respectivas telas CRUD, compostas por uma listagem em uma datatable com cada item contando com os respectivos botÃµes de ediÃ§Ã£o e exclusÃ£o. AlÃ©m de um botÃ£o que leva Ã  tela de criaÃ§Ã£o da correspondente entidade
A navegaÃ§Ã£o pode ser feita atravÃ©s de um menu hambÃºrguer acionado atravÃ©s de um botÃ£o no canto esquerdo superior (visto na Ã¡rea logada);

O funcionamento da aplicaÃ§Ã£o irÃ¡ ter algumas pequenas variaÃ§Ãµes dependendo do papel do usuÃ¡rio logado.
Papel ADM:
 - Ã‰ o Ãºnico papel que tem acesso pelo menu lateral Ã  pÃ¡gina de gerenciamento de usuÃ¡rios. O Ãºnico com permissÃ£o para criar , alterar ou excluir usuÃ¡rios.

Papel Triador:
- A diferenÃ§a notada pelo usuÃ¡rio que acessa a aplicaÃ§Ã£o utilizando este papel Ã© principalmente a tela de listagem e criaÃ§Ã£o/ediÃ§Ã£o de processos. 
Para o usuÃ¡rio triador, todos os prcessos criados sÃ£o listados.
Nas telas de criaÃ§Ã£o/ediÃ§Ã£o, um usuÃ¡rio triador verÃ¡ os campos de nome e descriÃ§Ã£o, mas alÃ©m deles, verÃ¡ tambÃ©m um componente TreePanel atravÃ©s do qual serÃ¡ possÃ­vel selecionar os usuÃ¡rios que deverÃ£o dar um parecer sobre aquele processo.

Papel Finalizador:
- Assim como o usuÃ¡rio triador, a diferenÃ§a se dÃ¡ na relaÃ§Ã£o com o fluxo relacionado Ã  entidade Processo.
Na listagem, esse usuÃ¡rio enxerga apenas os processos para os quais ele deve dar um parecer. ApÃ³s ele cumprir essa tarefa, o processo em questÃ£o nÃ£o serÃ¡ mais exibido para esse usuÃ¡rio.
AlÃ©m disso, na tela de ediÃ§Ã£o, um usuÃ¡rio finalizador, diferente do usuÃ¡rio triador, terÃ¡ disponÃ­vel, ao invÃ©s do treePanel, um componente textarea, atravÃ©s do qual poderÃ¡ emitir um parecer.
 
## Principais dificuldades pendÃªncias, e bugs

A configuraÃ§Ã£o do banco H2 em conjunto com o flywaydb tornou-se um empecilho a tal ponto que em dado momento a opÃ§Ã£o foi desistir das migrations e executar um script direto no banco para nÃ£o comprometer mais o prazo.
AlÃ©m dissso, a versÃ£o mais atualizada do spring boot conversa com uma versÃ£o do spring securiy que nÃ£o dÃ¡ suporte direto ao OAuth2 como fazia antes. A soluÃ§Ã£o temporÃ¡ria foi realizar downgrade. A soluÃ§Ã£o *a posteriori* Ã© estudar a documentaÃ§Ã£o e verificar uma nova forma de realizar a tarefa.
Ainda quanto Ã  autenticaÃ§Ã£o, mas dessa vez no frontend, a biblioteca angular2-jwt passou a se chamar  auth0/angular-jwt  para dar suporte ao angular 11, PorÃ©m isso foi feito modificando a forma como lida com o fluxo de armazenamento de token JWT. Foi necessÃ¡rio estudar a documentaÃ§Ã£o para utilizÃ¡-la no projeto.

O projeto ainda apresenta alguns dÃ©bitos tÃ©cnicos ou bugs, sobretudo no frontend.
- No Backend
	 - Tornar mais completa a captura e retorno de erros na API.
	 - tentar achar uma soluÃ§Ã£o para o problema apresentado pelo FlywayDB. (Pode ser algo especÃ­fico na relaÃ§Ã£o com o banco de dados H2 ou alguma configuraÃ§Ã£o);
 - No frontend:
	 - HÃ¡ um problema com a a comunicaÃ§Ã£o da api tornando necessÃ¡rio por vezes um refresh na pÃ¡gina da Ã¡rea logada, pois, em um primeiro momento pode ser erroneamente apresente um comportamento falso quanto Ã  autorizaÃ§Ã£o (negar acesso a um recurso que na realidade o usuÃ¡rio tem acesso)
	 - A ediÃ§Ã£o do processo feito por um triador pode apresentar algum comportamento inesperado quanto ao treepanel, pois estÃ¡ pendente a lÃ³gica para popular o componente com a mesma configuraÃ§Ã£o de como as entidades de processo e parecer foram salvas.
	 - Por fim,  Ã© necessÃ¡rio realizar algumas intervenÃ§Ãµes na usabilidade, escondendo alguns botÃµes ou componentes de acordo com a regra de cada papel, ainda que alguns dos mesmos terÃ£o sua funcionalidade barrada no backend ( Acesso ao endpoint);


## :computer: Quer contribuir com o Projeto? Saiba como:

-   FaÃ§a um  **fork**  do projeto;
-   Crie uma nova branch com as suas alteraÃ§Ãµes:  `git checkout -b my-feature`
-   Salve as alteraÃ§Ãµes e crie uma mensagem de commit contando o que vocÃª fez:`git commit -m "feature: My new feature"`
-   Envie as suas alteraÃ§Ãµes:  `git push origin my-feature`

> Caso tenha alguma dÃºvida confira este [guia de como contribuir no GitHub](https://github.com/firstcontributions/first-contributions)


## :memo: LicenÃ§a

Esse projeto estÃ¡ sob a licenÃ§a MIT. Veja o arquivo [LICENSE](LICENSE) para mais detalhes.

Feito com dedicaÃ§Ã£o por Luiz Serra ğŸ‘‹ğŸ½ [Entre em contato](https://www.linkedin.com/in/luizserra)!
